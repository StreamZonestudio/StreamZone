<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle del Producto</title>
  <link rel="icon" type="image/png" href="images/icono.png">
  <style>
    

   .contenido-container {
  display: flex;
  gap: 40px;
  margin-left: 280px; /* espacio para que no se sobreponga con el panel lateral */
  padding: 40px 20px; /* espaciado interno solo arriba/abajo y derecha */
}

.contenido-container img {
  width: 300px;
  border-radius: 10px;
}

.contenido-info {
  max-width: 600px;
}

.contenido-info h2 {
  font-size: 28px;
  margin-bottom: 10px;
}

.contenido-info p {
  margin-bottom: 20px;
}

.btn-carrito {
  background-color: #FFEB3B;
  border: none;
  padding: 12px 24px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 25px;
  cursor: pointer;
}

 body {
  margin: 0;
  font-family: Arial, sans-serif;
  background-image: url('images/starzone_fondo_principio.jpeg'); /* cambia por tu ruta */
  background-size: cover;
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-position: center;
  overflow-x: hidden;
}

.icono-usuario {
  position: absolute;
  top: 10px;
  right: 10px;
}

.icono-usuario img {
  width: 30px;
  height: 30px;
  cursor: pointer;
}

.sidebar {
  width: 250px;
  height: 100vh;
  background-color: rgb(251, 255, 0);
  color: black;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-top: 1rem;
  position: fixed; /* fija el sidebar */
  left: 0;
  top: 0;
  z-index: 10; /* para que esté encima de otros elementos */
}
.logo img {
  width: 300px;
  height: auto;
  margin-top: 150px; 
  margin-bottom: 5rem;
}
.animacion-panel {
  width: 110px;
  height: 150px;
  margin: auto;
  background: transparent;
   margin-top: 30px;
}

.animacion-panel img {
  width: 100%;
  height: auto;
}
.footer-sidebar {
  font-size: 12px;
  color: black;
  text-align: center;
  padding: 10px 5px 0;
  margin-top: auto;
}


.menu {
  display: flex;
  flex-direction: column;
  width: 100%;
  align-items: center;
  margin-top: 10px;
}

.menu a {
  text-decoration: none;
  color: rgb(0, 0, 0);
  font-size: 16px;
  padding: 10px 0;
  width: 100%;
  text-align: center;
  transition: background 0.3s;
}


.menu a:hover {
  background-color: #333;
}

.fondo-central {
  margin-left: 250px; /* para dejar espacio al sidebar */
  width: calc(100% - 250px); /* resto del ancho total sin el sidebar */
  height: 100px; /* ajusta la altura según lo que desees */
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: black;
}

.fondo-central img {
  width: 50%;
  height: 50%;
  object-fit: cover;
}
#titulo-producto {
  color: #ffffff; /* o el color que prefieras */
  font-size: 28px; /* puedes ajustar tamaño si deseas */
  text-shadow: 1px 1px 2px #ffffff; /* opcional: mejora visibilidad si hay fondo */
}

#descripcion-producto {
  font-size: 24px;
  font-weight: bold;
  color: #ffd209; /* o el color que prefieras */
}

#detalle-producto {
  color: #ffffff; /* Puedes usar cualquier color o código hexadecimal */
}
.modal {
  display: none;              /* oculto por defecto */
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

.modal-content {
  background: #111;
  padding: 20px 30px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 0 15px rgba(255,255,0,0.4);
  max-width: 320px;
}

.modal-content p {
  color: #FFD700;
  font-size: 1.1em;
  margin-bottom: 20px;
}

.modal-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.modal-buttons .btn {
  padding: 10px 20px;
  background: #FFD700;
  color: #000;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.modal-buttons .btn:hover {
  background: #e6c200;
}

.modal-buttons .btn-cancel {
  background: #333;
  color: #fff;
}

.modal-buttons .btn-cancel:hover {
  background: #555;
}
.toast-error {
  display: none;
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #dc3545; /* rojo */
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  font-weight: bold;
  z-index: 1000;
}

.toast-error.show {
  display: block;
  animation: fadeoutError 3s forwards;
}

@keyframes fadeoutError {
  0% { opacity: 1; }
  80% { opacity: 1; }
  100% { opacity: 0; }
}

@media screen and (max-width: 768px) {

  body {
  background-attachment: scroll;
}



/* 🔥 Panel amarillo superior */
.sidebar {
    width: 100%;
    height: 100px;
    position: fixed;
    top: 0px; /* ✅ lo baja un poco */
    left: 0;
    background-color: rgb(251, 255, 0);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }

.logo img {
    width: 190px;
    margin: 0;
  }
.menu {
    display: flex;
    flex-direction: row; /* 🔥 En fila */
    justify-content: center;
    align-items: center;
    gap: 15px; /* Espacio entre botones */
    width: 100%;
    margin-top: 5px;
  }

  .menu a {
    padding: 6px 10px;
    font-size: 13px;
    color: rgb(0, 0, 0);
    border-radius: 15px;
    text-align: center;
    min-width: 60px;
    transition: background-color 0.3s;
  }

  .menu a:hover {
    background-color: rgb(48, 48, 48);
  }

.buscador,
.footer-sidebar{
  display: none;
}






/* 🔥 Contenedor principal */
.contenido-container {
    margin-left: 0;
    margin-top: 100px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 18px;
    text-align: center;
  }

.contenido-container h2 {
    color: white;
    font-size: 24px;
    text-shadow: 1px 1px 2px black;
  }

.contenido-container img {
    width: 90%;
    max-width: 320px;
    border-radius: 10px;
  }

.info-linea {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
}

 .info-linea p {
    color: white;
    font-weight: bold;
    margin: 0;
  }

  #detalle-producto {
    color: white;
    text-align: center;
    font-size: 16px;
  }

/* 🔥 Botón comprar */
.btn-carrito {
  background-color: #FFEB3B;
  border: none;
  padding: 8px 20px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 25px;
  cursor: pointer;
}

.btn-carrito:hover {
  background-color: #e6c200;
}

/* 🔥 Panel de cuenta entregada */
.panel-cuenta {
  background-color: rgba(0, 0, 0, 0.8);
  padding: 16px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  color: white;
}

.panel-cuenta h3 {
  color: #FFD700;
  text-align: center;
}

.panel-cuenta table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

.panel-cuenta th,
.panel-cuenta td {
  border: 1px solid #FFD700;
  padding: 8px;
  text-align: center;
}

.panel-cuenta th {
  color: #FFD700;
}

/* 🔥 Modal */
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

.modal-content {
  background: #111;
  padding: 20px 30px;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 0 15px rgba(255,255,0,0.4);
  max-width: 320px;
}
.animacion-panel img,
  .animacion-panel{
    display: none;
  }


.modal-content p {
  color: #FFD700;
  margin-bottom: 20px;
}

.modal-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.modal-buttons .btn {
  padding: 10px 20px;
  background: #FFD700;
  color: #000;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.modal-buttons .btn-cancel {
  background: #333;
  color: #fff;
}

.modal-buttons .btn:hover {
  background: #e6c200;
}

.modal-buttons .btn-cancel:hover {
  background: #555;
}

/* 🔥 Toast Error */
.toast-error {
  display: none;
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #dc3545;
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  font-weight: bold;
  z-index: 1000;
}

.toast-error.show {
  display: block;
  animation: fadeoutError 3s forwards;
}

@keyframes fadeoutError {
  0% { opacity: 1; }
  80% { opacity: 1; }
  100% { opacity: 0; }
}

}





  </style>
</head>
<body>
  


<div class="sidebar">
  <div class="icono-usuario">
    <img src="images/starzone_login_icono.png" alt="Usuario" onclick="location.href='index.html'"/>
  </div>
  <div class="logo">
    <img src="images/starzone_logo_panel.png" alt="Logo">
  </div>

  <nav class="menu">
    <a href="inicio.html">Inicio</a>
    <a href="tienda.html">Tienda</a>
    <a id="botonSaldo" class="saldo-boton">Saldo: </a>
  </nav>
   <div class="animacion-panel">
  <img src="images/animacion.gif" alt="Animación">
</div>
<div class="footer-sidebar">
  StreamZone © 2023. Todos los derechos reservados.
</div>
</div>

<div class="contenido-container">
  <img id="imagen-producto" src="" alt="Producto">
  <div class="contenido-info">
    <h2 id="titulo-producto"></h2>
    <p id="descripcion-producto"></p>
    <p id="disponibles" style="font-weight:bold; color:white; margin:8px 0;">Cuentas disponibles:</p>
    <p id="detalle-producto"></p>
    <button id="btnComprar" class="btn-carrito">Comprar</button>
    <div id="cuentaEntregada"></div>
  </div>
</div>

<!-- Modal -->
<div id="modalConfirm" class="modal">
  <div class="modal-content">
    <p id="modalMensaje">¿Estás seguro que quieres comprar este producto?</p>
    <div class="modal-buttons">
      <button id="modalAceptar" class="btn">Sí, comprar</button>
      <button id="modalCancelar" class="btn btn-cancel">Cancelar</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div id="toastError" class="toast-error">❌ Error</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyChR5sX3krnDeB1oNVo7aW9hoLPhJnJpec",
  authDomain: "streanzone-4c7d5.firebaseapp.com",
  projectId: "streanzone-4c7d5",
  storageBucket: "streanzone-4c7d5.appspot.com",
  messagingSenderId: "817356278560",
  appId: "1:817356278560:web:142fdf6466f6d20b9f6545"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Productos
const productos = {
   1: {
        imagen: "images/1.jpg",
        titulo: "AMAZON PANTALLA",
        descripcion: "⭐$6.000",
        
        detalle: "Disfruta tus series y películas favoritas con acceso a una pantalla de Prime Video, ideal para entretenimiento personal."
      },
      2: {
        imagen: "images/1.jpg",
        titulo: "AMAZON COMPLETA ",
        descripcion: "⭐$10.000",
        detalle: "Accede a todos los perfiles de Prime Video y disfruta contenido exclusivo sin límites desde cualquier dispositivo."
      },
      3: {
        imagen: "images/3.jpg",
        titulo: "CANVA 45 DIAS",
        descripcion: "⭐$10.000",
        detalle: "Crea diseños impactantes con acceso a Canva Pro durante 45 días, ideal para estudiantes, emprendedores y creadores de contenido. Este servicio es a dominio, lo que significa que se activa con tu propio correo electrónico, solo debes enviar una captura del ticket de compra y el correo con el que deseas activar el servicio."
      },
      4: {
        imagen: "images/3.jpg",
        titulo: "CANVA 1 AÑO",
        descripcion: "⭐$50.000",
        detalle: "Crea diseños impactantes con acceso a Canva Pro durante 1 año, ideal para estudiantes, emprendedores y creadores de contenido. Este servicio es a dominio, lo que significa que se activa con tu propio correo electrónico, solo debes enviar una captura del ticket de compra y el correo con el que deseas activar el servicio."
      },
      5: {
        imagen: "images/6.jpg",
        titulo: "CLARO VIDEO CONWIN +",
        descripcion: " ⭐$17.000",
        detalle: " Acceso total a Claro Video y Win+, perfecto para ver novelas, series y deportes en vivo sin interrupciones."
      },
      6: {
        imagen: "images/7.jpg",
        titulo: "CRUNCHYROLL PANTALLA",
        descripcion: "⭐$6.000",
        detalle: "Vive el anime como nunca antes con acceso a un perfil de Crunchyroll, con episodios subtitulados en tiempo real."
      },
      7: {
        imagen: "images/7.jpg",
        titulo: "CRUNCHYROLL COMPLETA",
        descripcion: "⭐$12.000",
        detalle: "Disfruta todo el catálogo de Crunchyroll sin anuncios y con múltiples pantallas para compartir."
      },
      8: {
        imagen: "images/10.jpg",
        titulo: "DIRECTV GO ",
        descripcion: "⭐$15.000",
        detalle: " Televisión en vivo y contenido on-demand con la calidad de DIRECTV en todos tus dispositivos."
      },
      9: {
        imagen: "images/11.jpg",
        titulo: "DIRECTVGO-WIN+ ",
        descripcion: "⭐$29.000",
        detalle: " Paquete premium con canales deportivos y de entretenimiento en vivo. Ideal para toda la familia."
      },
      10: {
        imagen: "images/12.jpg",
        titulo: "DISNEY ESTANDAR PANTALLA",
        descripcion: "⭐$12.000",
        detalle: " Revive tus clásicos favoritos y las últimas producciones de Disney con acceso a una pantalla."
      },
      11: {
        imagen: "images/13.jpg",
        titulo: "DISNEY PREMIUM PANTALLA ",
        descripcion: "⭐$15.000",
        detalle: "Acceso premium a Disney+, con mejor calidad de imagen y disponibilidad anticipada de estrenos."
      },
      12: {
        imagen: "images/14.jpg",
        titulo: "DUOLINGO ",
        descripcion: "⭐$10.000",
        detalle: " Aprende idiomas de forma divertida y eficaz con Duolingo Plus, sin anuncios y con funciones exclusivas."
      },
      13: {
        imagen: "images/16.jpg",
        titulo: "IPTV PANTALLA ",
        descripcion: "⭐$10.000",
        detalle: "Acceso a cientos de canales internacionales en una sola pantalla. Ideal para los amantes de la TV global."
      },
      14: {
        imagen: "images/16.jpg",
        titulo: "IPTV COMPLETA 3 DISPOSITIVOS ",
        descripcion: "⭐$20.000",
        detalle: " Comparte tu IPTV en 3 dispositivos y accede a una gran variedad de canales de todo el mundo."
      },
      15: {
        imagen: "images/17.jpg",
        titulo: "MAGIS TV PANTALLA ",
        descripcion: "⭐$10.000",
        detalle: " Disfruta la mejor programación nacional e internacional con acceso exclusivo a una pantalla."
      },
      16: {
        imagen: "images/17.jpg",
        titulo: "MAGIS TV COMPLETA ",
        descripcion: "⭐$25.000",
        detalle: "Todo el contenido de Magis TV en múltiples dispositivos, con acceso completo a canales premium."
      },
      17: {
        imagen: "images/18.jpg",
        titulo: "MAX PANTALLA (30-45 DIAS) ",
        descripcion: "⭐$6.000",
        detalle: "Vive la experiencia de HBO Max con una pantalla activa por hasta 45 días. Ideal para maratones."
      },
      18: {
        imagen: "images/18.jpg",
        titulo: "MAX COMPLETA (30-45 DIAS)",
        descripcion: "⭐$23.000",
        detalle: "Acceso completo a HBO Max durante 45 días, para disfrutar películas, series y documentales."
      },
      19: {
        imagen: "images/19.jpg",
        titulo: "NETFLIX PANTALLA ",
        descripcion: "⭐$10.000",
        detalle: "Mira tus contenidos favoritos en una pantalla dedicada de Netflix. Calidad y variedad aseguradas."
      },
      20: {
        imagen: "images/20.jpg",
        titulo: "NETFLIX PANTALLA INTERNACIONAL ",
        descripcion: "⭐$10.000",
        detalle: "Acceso internacional a Netflix, ideal para quienes buscan contenido exclusivo de otras regiones."
      },
      21: {
        imagen: "images/23.jpg",
        titulo: "PARAMOUNT PANTALLA ",
        descripcion: "⭐$6.000",
        detalle: " Disfruta series, películas y realities con acceso básico a Paramount+."
      },
      22: {
        imagen: "images/23.jpg",
        titulo: "PARAMOUNT COMPLETA ",
        descripcion: "⭐$12.000",
        detalle: " Acceso completo a todos los perfiles y funciones de Paramount+. Ideal para fans de series originales."
      },
      23: {
        imagen: "images/24.jpg",
        titulo: "PLEX PANTALLA",
        descripcion: "⭐$6.000",
        detalle: " Accede a miles de películas y canales en vivo desde una pantalla en Plex, sin complicaciones."
      },
      24: {
        imagen: "images/24.jpg",
        titulo: "PLEX COMPLETA",
        descripcion: "⭐$12.000",
        detalle: "Disfruta la experiencia completa de Plex con perfiles múltiples y contenido exclusivo bajo demanda."
      },
      25: {
        imagen: "images/26.jpg",
        titulo: "PROFE NET WIN+ ",
        descripcion: "⭐$10.000",
        detalle: "La herramienta ideal para estudiantes y profesores con acceso a recursos educativos y entretenimiento."
      },
      26: {
        imagen: "images/29.jpg",
        titulo: "UNIVERSAL + PANTALLA",
        descripcion: "⭐$6.000",
        detalle: " Vive la experiencia de Universal+ con contenido exclusivo en una pantalla."
      },
      27: {
        imagen: "images/30.jpg",
        titulo: "RAKUTEN VIKI PANTALLA",
        descripcion: "⭐$6.000",
        detalle: "Disfruta los mejores dramas asiáticos en una pantalla, con subtítulos y actualizaciones diarias."
      },
      28: {
        imagen: "images/30.jpg",
        titulo: "RAKUTEN VIKI COMPLETA",
        descripcion: "⭐$8.000",
        detalle: " Acceso total al catálogo de Viki. Perfecto para los fanáticos del contenido coreano, chino y japonés."
      },
      29: {
        imagen: "images/27.jpg",
        titulo: "SPOTIFY 1 MES",
        descripcion: "⭐$8.000",
        detalle: " Un mes de música sin anuncios y con descargas ilimitadas. Ideal para probar Spotify Premium."
      },
      30: {
        imagen: "images/27.jpg",
        titulo: "SPOTIFY 3 MESES",
        descripcion: "⭐$18.000",
        detalle: "Tres meses de música sin interrupciones, calidad mejorada y sin necesidad de conexión."
      },
      31: {
        imagen: "images/31.jpg",
        titulo: "VIX PANTALLA",
        descripcion: "⭐$6.000",
        detalle: "Películas y telenovelas gratis en una pantalla con contenido latino exclusivo."
      },
     32: {
        imagen: "images/31.jpg",
        titulo: "VIX COMPLETA",
        descripcion: "⭐$12.000",
        detalle: " Accede al catálogo completo de Vix en varios dispositivos y sin límites."
      },
      33: {
        imagen: "images/32.jpg",
        titulo: "YOUTUBE 1 MES",
        descripcion: "⭐$8.000",
        detalle: "YouTube Premium durante un mes: sin anuncios, reproducción en segundo plano y descargas."
      },
      34: {
        imagen: "images/32.jpg",
        titulo: "YOUTUBE 3 MESES",
        descripcion: "⭐$22.000",
        detalle: " Disfruta YouTube sin interrupciones durante tres meses. Ideal para maratones de contenido."
      },
      35: {
        imagen: "images/2.jpg",
        titulo: "APPLE TV X1 MES PANTALLA",
        descripcion: "⭐$8.000",
        detalle: " "
      },
       36: {
        imagen: "images/33.jpg",
        titulo: "CAPCUT PRO(1 DISPOSITIVOS)",
        descripcion: "⭐$25.000",
        detalle: " "
      },
       37: {
        imagen: "images/34.jpg",
        titulo: "CHATGPT PLUS",
        descripcion: "⭐$20.000",
        detalle: " "
      },
      38: {
        imagen: "images/8.jpg",
        titulo: "CURIOSITY STREAM",
        descripcion: "⭐$6.000",
        detalle: " "
      },
      39: {
        imagen: "images/9.jpg",
        titulo: "DEEZER X1 MES",
        descripcion: "⭐$10.000",
        detalle: " "
      },
      40:{
        imagen: "images/21.jpg",
        titulo: "OFFICE 365 X 1 AÑO (1 DISPOSITIVO)",
        descripcion: "⭐$60.000",
        detalle: " "
      },
      41:{
        imagen: "images/35.jpg",
        titulo: "BRAZZERS X2 MESES PANTALLA",
        descripcion: "⭐$15.000",
        detalle: " "
      },
      42:{
        imagen: "images/15.jpg",
        titulo: "HOT-GO(XXX) PANTALLA",
        descripcion: "⭐$10.000",
        detalle: " "
      },
      43:{
        imagen: "images/22.jpg",
        titulo: "ONLY FANS 100 DOLARES",
        descripcion: "⭐$50.000",
        detalle: "4 Horas de garantia. "
      },
      44:{
        imagen: "images/25.jpg",
        titulo: "PORNHUB PREMIUM X1 MES PANTALLA",
        descripcion: "⭐$10.000",
        detalle: ""
      },
       45:{
        imagen: "images/28.jpg",
        titulo: "TINDER+ X6 MESES",
        descripcion: "⭐$30.000",
        detalle: ""
      },
      46:{
        imagen: "images/36.jpg",
        titulo: "XVIDEOS PREMIUM PANTALLA",
        descripcion: "⭐$15.000",
        detalle: ""
      },
      47:{
        imagen: "images/37.jpg",
        titulo: "XNXX GOLD PANTALLA",
        descripcion: "⭐$15.000",
        detalle: ""
      },
      48: {
        imagen: "images/27.jpg",
        titulo: "SPOTIFY 2 MES",
        descripcion: "⭐$15.000",
        detalle: " Dos mes de música sin anuncios y con descargas ilimitadas. Ideal para probar Spotify Premium."
      },
      49: {
        imagen: "images/32.jpg",
        titulo: "YOUTUBE 2 MESES",
        descripcion: "⭐$15.000",
        detalle: " Disfruta YouTube sin interrupciones durante dos meses. Ideal para maratones de contenido."
      },
      50: {
        imagen: "images/14.jpg",
        titulo: "DUOLINGO X1 AÑO",
        descripcion: "⭐$120.000",
        detalle: " Aprende idiomas de forma divertida y eficaz con Duolingo Plus, sin anuncios y con funciones exclusivas."
      },
      



};

// Obtener ID desde URL
const params = new URLSearchParams(window.location.search);
const id = params.get('id');
const producto = productos[id];

// Mostrar datos del producto
if (producto) {
  document.getElementById("imagen-producto").src = producto.imagen;
  document.getElementById("titulo-producto").textContent = producto.titulo;
  document.getElementById("descripcion-producto").textContent = producto.descripcion;
  document.getElementById("detalle-producto").textContent = producto.detalle;
} else {
  document.body.innerHTML = "<p style='color:white;'>Producto no encontrado.</p>";
}

// Función para mostrar saldo
async function mostrarSaldo() {
  const correo = sessionStorage.getItem("usuario");
  const botonSaldo = document.getElementById("botonSaldo");
  if (correo) {
    const docRef = doc(db, "saldos", correo);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      const saldo = docSnap.data().saldo;
      botonSaldo.textContent = `Saldo: $${parseInt(saldo).toLocaleString("es-CO")}`;
    } else {
      botonSaldo.textContent = "Saldo: $0";
    }
  } else {
    botonSaldo.textContent = "Saldo: No disponible";
  }
}

// Función para mostrar cuentas disponibles
async function actualizarDisponibles() {
  if (!producto) return;
  const plataforma = producto.titulo.trim();
  const cuentasRef = collection(db, "plataformas", plataforma, "cuentas");
  const q = query(cuentasRef, where("estado", "==", "activa"));
  const querySnapshot = await getDocs(q);
  const disponibles = querySnapshot.size;

  const elm = document.getElementById("disponibles");
  elm.textContent = `Cuentas disponibles: ${disponibles}`;
  elm.style.color = disponibles > 0 ? "white" : "red";

  document.getElementById("btnComprar").disabled = (disponibles === 0);
}

// Toast
function mostrarToastError(mensaje) {
  const errorBox = document.getElementById("toastError");
  errorBox.textContent = mensaje;
  errorBox.classList.add("show");
  setTimeout(() => {
    errorBox.classList.remove("show");
  }, 3000);
}

// Modal
function mostrarModal(mensaje, onAceptar, onCancelar) {
  const modal = document.getElementById("modalConfirm");
  document.getElementById("modalMensaje").textContent = mensaje;
  modal.style.display = "flex";

  const aceptar = () => {
    modal.style.display = "none";
    onAceptar();
  };
  const cancelar = () => {
    modal.style.display = "none";
    onCancelar();
  };

  document.getElementById("modalAceptar").onclick = aceptar;
  document.getElementById("modalCancelar").onclick = cancelar;
}

// Compra
document.getElementById("btnComprar").addEventListener("click", () => {
  mostrarModal(
    "¿Estás seguro que quieres comprar este producto?",
    async () => {
      const correo = sessionStorage.getItem("usuario");
      if (!correo) {
        mostrarToastError("❌ No has iniciado sesión.");
        return;
      }

      const precio = parseInt(producto.descripcion.match(/\$([\d.]+)/)[1].replace(/\./g,""));
      const docRef = doc(db, "saldos", correo);
      const docSnap = await getDoc(docRef);
      let saldo = docSnap.exists() ? docSnap.data().saldo : 0;

      if (saldo < precio) {
        mostrarToastError("❌ Saldo insuficiente");
        return;
      }

      const plataforma = producto.titulo.trim();
      const cuentasRef = collection(db, "plataformas", plataforma, "cuentas");
      const q = query(cuentasRef, where("estado", "==", "activa"));
      const querySnapshot = await getDocs(q);

      if (querySnapshot.empty) {
        mostrarToastError("❌ No hay cuentas disponibles.");
        return;
      }

      const cuentaDoc = querySnapshot.docs[0];
      const cuenta = cuentaDoc.data();

      await updateDoc(docRef, { saldo: saldo - precio });
      sessionStorage.setItem("saldoActual", saldo - precio);

      await updateDoc(doc(db, "plataformas", plataforma, "cuentas", cuentaDoc.id), {
        estado: "inactiva"
      });

      const cont = document.getElementById("cuentaEntregada");
      cont.innerHTML = `
        <h3 style="color:#FFD700;margin-top:20px">🎉 Cuenta Entregada:</h3>
        <table style="width:100%;border-collapse:collapse">
          <tr>
            <th style="border:1px solid #FFD700;padding:8px;color:white">Correo</th>
            <th style="border:1px solid #FFD700;padding:8px;color:white">Contraseña</th>
            <th style="border:1px solid #FFD700;padding:8px;color:white">Perfil</th>
          </tr>
          <tr>
            <td style="border:1px solid #FFD700;padding:8px;color:white">${cuenta.correo}</td>
            <td style="border:1px solid #FFD700;padding:8px;color:white">${cuenta.contrasena}</td>
            <td style="border:1px solid #FFD700;padding:8px;color:white">${cuenta.perfil || "-"}</td>
          </tr>
        </table>
      `;

      actualizarDisponibles();
      mostrarSaldo();
    },
    () => {}
  );
});

// Ejecutar
mostrarSaldo();
actualizarDisponibles();

</script>

</body>
</html>
